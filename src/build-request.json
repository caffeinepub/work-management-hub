{
  "kind": "build_request",
  "title": "Fix user approval synchronization and backend role assignment",
  "projectName": "Work Management Hub",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In UserManagementPage.tsx, ensure the 'User Pending' card displays data directly from actor.listApprovals() without manual status filtering. Remove any filter logic that checks u.status === Status.pending if the data from listApprovals() does not include a status field.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Buka `UserManagementPage.tsx`. Jangan lakukan filter manual `u.status === Status.pending` jika data dari `listApprovals()` tidak memiliki field status tersebut."
        ]
      },
      "acceptanceCriteria": [
        "The 'User Pending' card in UserManagementPage.tsx displays the same pending user data visible in the main Dashboard",
        "No manual status filtering is applied if listApprovals() data lacks status field",
        "Pending user count matches between Dashboard and User Management page"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the approveUser(principalId: Principal) function in backend/main.mo to: 1) Find the user profile by Principal, 2) Extract the requestedRole value from the profile, 3) Update the user status to #active, 4) Assign the user's role to match their requestedRole (e.g., change from #pending to #client or #asistenmu), 5) Allow users with Superadmin role to execute this function.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Update fungsi `approveUser(principalId: Principal)` di backend",
          "Ambil nilai `requestedRole` dari profilnya",
          "Update status user menjadi #active",
          "Pindahkan/Set role user tersebut menjadi role yang sesuai dengan `requestedRole` tadi"
        ]
      },
      "acceptanceCriteria": [
        "approveUser successfully retrieves requestedRole from user profile",
        "User status changes to #active after approval",
        "User role is updated to match their requestedRole value",
        "Superadmin role can execute approveUser function",
        "Approve button responds and processes user approvals correctly"
      ]
    },
    {
      "id": "REQ-3",
      "text": "In UserManagementTable.tsx, after a successful await actor.approveUser call, trigger refetch() or invalidateQueries for query keys ['allUsers'] and ['approvals'] to automatically refresh the data and move the approved user from the pending card to the appropriate role card.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Di `UserManagementTable.tsx`, pastikan setelah `await actor.approveUser`, panggil `refetch()` atau `invalidateQueries` untuk key `['allUsers']` dan `['approvals']`"
        ]
      },
      "acceptanceCriteria": [
        "After approving a user, both ['allUsers'] and ['approvals'] queries are invalidated",
        "Approved users immediately disappear from the pending card",
        "Approved users appear in the correct role category card without manual page refresh"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor architecture in backend/main.mo",
    "Do not modify Internet Identity hooks or authentication flow",
    "Preserve existing user data structure and migration compatibility"
  ],
  "nonGoals": [
    "Changing the overall role system or adding new roles",
    "Modifying the UI design or layout of the User Management page",
    "Implementing additional approval workflow features beyond fixing the current synchronization issue"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}