{
  "kind": "build_request",
  "title": "Fix Superadmin authorization in user role assignment helper functions",
  "projectName": "Work Management Hub",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Locate the helper function in backend/main.mo that validates authorization for assigning user roles (likely `assignUserRole`, `assignCallerUserRole`, or similar) which currently throws the error message 'Only admins can assign user roles'",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-8"
        ],
        "quotes": [
          "Cari fungsi yang bertugas menetapkan role user (misalnya `assignUserRole` atau yang memunculkan pesan error \"Only admins can assign user roles\")"
        ]
      },
      "acceptanceCriteria": [
        "The specific helper function responsible for role assignment authorization is identified",
        "The function currently restricts access to only 'admin' role"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the authorization logic in the role assignment helper function to allow callers with either 'superadmin' OR 'admin' role (case-insensitive comparison with lowercase string values)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-8"
        ],
        "quotes": [
          "Ubah logika pengecekan otorisasinya agar fungsi tersebut MENGIZINKAN pemanggil dengan role \"Superadmin\" ATAU \"Admin\""
        ]
      },
      "acceptanceCriteria": [
        "The helper function's authorization check accepts both 'admin' and 'superadmin' roles",
        "Role comparison uses lowercase string matching to handle backend storage format",
        "The error 'Unauthorized: Only admins can assign user roles' is no longer thrown for Superadmin callers"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Audit all other helper functions related to the user approval/rejection workflow in backend/main.mo to ensure none are exclusively restricted to 'admin' role when they should also allow 'superadmin'",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-8"
        ],
        "quotes": [
          "Pastikan tidak ada lagi fungsi helper terkait proses Approve/Reject yang masih eksklusif untuk Admin saja"
        ]
      },
      "acceptanceCriteria": [
        "All helper functions called during user approval flow allow both 'admin' and 'superadmin' roles",
        "All helper functions called during user rejection flow allow both 'admin' and 'superadmin' roles",
        "No authorization errors occur when Superadmin performs approval or rejection actions"
      ]
    }
  ],
  "constraints": [
    "Only modify backend Motoko code in backend/main.mo",
    "Do not change the frontend code",
    "Maintain case-insensitive role comparison using lowercase string values as stored in backend",
    "Preserve existing authorization logic for other roles and operations"
  ],
  "nonGoals": [
    "Adding new roles or permissions",
    "Changing the user interface",
    "Modifying the approval workflow logic beyond authorization fixes",
    "Restructuring the backend architecture"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}