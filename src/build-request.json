{
  "kind": "build_request",
  "title": "Fix access-control.mo to recognize Superadmin role",
  "projectName": "Asistenmu Platform",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the UserRole enum in backend/access-control.mo to include #superadmin variant alongside existing role variants",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "UPDATE ENUM ROLE (Baris ~7): Tambahkan `#superadmin` ke dalam `public type UserRole`."
        ]
      },
      "acceptanceCriteria": [
        "UserRole type definition includes #superadmin variant",
        "Enum structure remains compatible with existing role system"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Modify the isAdmin function in backend/access-control.mo to return true when the user role is either #admin or #superadmin, using pattern: let role = getUserRole(state, caller); return role == #admin or role == #superadmin;",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "UPDATE LOGIKA ISADMIN (Baris ~62): Ubah fungsi `isAdmin(state, caller)` agar MENGIZINKAN `#superadmin`. Contoh: `let role = getUserRole(state, caller);` `return role == #admin or role == #superadmin;`"
        ]
      },
      "acceptanceCriteria": [
        "isAdmin function returns true for users with #superadmin role",
        "isAdmin function returns true for users with #admin role",
        "Function logic uses getUserRole to retrieve current role"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Implement state synchronization mechanism in backend to ensure Superadmin Principal is correctly assigned #superadmin role in AccessControlState, either through a dedicated force-update function or by bypassing isAdmin check in assignRole when caller is Superadmin from the main.mo role system",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "SINKRONISASI DATA (Penting): Karena akun saya saat ini mungkin sudah terlanjur terekam sebagai `#user` di `AccessControlState`, tolong buatkan fungsi khusus (sementara) di backend atau update logika saat inisialisasi agar Principal saya (Superadmin) di-force update role-nya menjadi `#superadmin` atau `#admin` di dalam state `access-control` tersebut. Atau, bypass saja pengecekan `isAdmin` di `assignRole` jika pemanggilnya adalah Superadmin dari sistem role utama di `main.mo`."
        ]
      },
      "acceptanceCriteria": [
        "Superadmin Principal from main.mo role system can successfully call assignRole without trap",
        "State synchronization ensures Superadmin role is properly recognized in access-control module",
        "Solution handles existing state where Superadmin may be incorrectly recorded as #user"
      ]
    }
  ],
  "constraints": [
    "Maintain compatibility with existing role system in main.mo that defines 8 user roles (superadmin, admin, finance, concierge, strategicPartner, asistenmu, client, partner)",
    "Preserve existing authorization logic for other roles",
    "Do not break existing admin approval workflow"
  ],
  "nonGoals": [
    "Modifying the main.mo role system structure",
    "Changing frontend role badge components",
    "Altering user registration or approval flows beyond authorization fix"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}